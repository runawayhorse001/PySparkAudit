

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Auditing Demos &mdash; PySparkAudit: PySpark Data Audit  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/fix_rtd.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Main Reference" href="reference.html" />
    <link rel="prev" title="3. PySpark Data Audit Functions" href="basics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PySparkAudit: PySpark Data Audit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. How to Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">3. PySpark Data Audit Functions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Auditing Demos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#auditing-function-by-function">4.1. Auditing function by function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#auditing-in-one-function">4.2. Auditing in one function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#print-in-bash">4.2.1. print in bash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#audited-results-folder">4.2.2. Audited results folder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#auditing-on-big-dataset">4.3. Auditing on Big Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">4.3.1. print in bash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">4.3.2. Audited results folder</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">5. Main Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PySparkAudit: PySpark Data Audit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>4. Auditing Demos</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="auditing-demos">
<span id="demo"></span><h1>4. Auditing Demos<a class="headerlink" href="#auditing-demos" title="Permalink to this headline">¶</a></h1>
<p>The following demos are designed to show how to use <code class="docutils literal notranslate"><span class="pre">PySparkAudit</span></code> to aduit rdd <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="section" id="auditing-function-by-function">
<h2>4.1. Auditing function by function<a class="headerlink" href="#auditing-function-by-function" title="Permalink to this headline">¶</a></h2>
<p>If you just need a piece of the audit result, you can call the corresponding function to generate it.
There are 9 basic auditing functions, 3 figure plot functions and 3 summary functions in the PySparkAudit library.</p>
<p>syntax</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>from PySparkAudit import *
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">Basic Functions:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>data_types: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.data_types</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.dtypes_class</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.counts</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.describe</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.percentiles</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.feature_len</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.freq_items</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.rates</span></code></li>
<li>dtypes_class: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.corr_matrix</span></code></li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Plot Functions:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>hist_plot: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.hist_plot</span></code></li>
<li>bar_plot: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.bar_plot</span></code></li>
<li>trend_plot: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.trend_plot</span></code></li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Summary Functions</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>dataset_summary: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.dataset_summary</span></code></li>
<li>numeric_summary: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.numeric_summary</span></code></li>
<li>category_summary: <code class="xref py py-mod docutils literal notranslate"><span class="pre">PySparkAudit.category_summary</span></code></li>
</ol>
</div></blockquote>
</li>
</ol>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark regression example&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.some.config.option&quot;</span><span class="p">,</span> <span class="s2">&quot;some-value&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>


<span class="c1"># import PySpark Audit functions</span>
<span class="kn">from</span> <span class="nn">PySparkAudit</span> <span class="kn">import</span> <span class="n">data_types</span><span class="p">,</span> <span class="n">hist_plot</span><span class="p">,</span> <span class="n">bar_plot</span><span class="p">,</span> <span class="n">freq_items</span><span class="p">,</span><span class="n">feature_len</span>
<span class="kn">from</span> <span class="nn">PySparkAudit</span> <span class="kn">import</span> <span class="n">dataset_summary</span><span class="p">,</span> <span class="n">rates</span>
<span class="kn">from</span> <span class="nn">PySparkAudit</span> <span class="kn">import</span> <span class="n">trend_plot</span><span class="p">,</span> <span class="n">auditing</span>

<span class="c1"># load dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;Heart.csv&#39;</span><span class="p">,</span>
                      <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># audit function by function</span>

<span class="c1"># data types</span>
<span class="k">print</span><span class="p">(</span><span class="n">data_types</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># check frequent items</span>
<span class="k">print</span><span class="p">(</span><span class="n">freq_items</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># bar plot for categorical features</span>
<span class="n">bar_plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>  <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>      feature  dtypes
<span class="m">0</span>         Age     int
<span class="m">1</span>         Sex     int
<span class="m">2</span>   ChestPain  string
<span class="m">3</span>      RestBP     int
<span class="m">4</span>        Chol     int
<span class="m">5</span>         Fbs     int
<span class="m">6</span>     RestECG     int
<span class="m">7</span>       MaxHR     int
<span class="m">8</span>       ExAng     int
<span class="m">9</span>     Oldpeak  double
<span class="m">10</span>      Slope     int
<span class="m">11</span>         Ca  string
<span class="m">12</span>       Thal  string
<span class="m">13</span>        AHD  string
      feature                            freq_items<span class="o">[</span>value, freq<span class="o">]</span>
<span class="m">0</span>         Age  <span class="o">[[</span><span class="m">58</span>, <span class="m">19</span><span class="o">]</span>, <span class="o">[</span><span class="m">57</span>, <span class="m">17</span><span class="o">]</span>, <span class="o">[</span><span class="m">54</span>, <span class="m">16</span><span class="o">]</span>, <span class="o">[</span><span class="m">59</span>, <span class="m">14</span><span class="o">]</span>, <span class="o">[</span><span class="m">52</span>, ...
<span class="m">1</span>         Sex                                <span class="o">[[</span><span class="m">1</span>, <span class="m">206</span><span class="o">]</span>, <span class="o">[</span><span class="m">0</span>, <span class="m">97</span><span class="o">]]</span>
<span class="m">2</span>   ChestPain  <span class="o">[[</span>asymptomatic, <span class="m">144</span><span class="o">]</span>, <span class="o">[</span>nonanginal, <span class="m">86</span><span class="o">]</span>, <span class="o">[</span>nonty...
<span class="m">3</span>      RestBP  <span class="o">[[</span><span class="m">120</span>, <span class="m">37</span><span class="o">]</span>, <span class="o">[</span><span class="m">130</span>, <span class="m">36</span><span class="o">]</span>, <span class="o">[</span><span class="m">140</span>, <span class="m">32</span><span class="o">]</span>, <span class="o">[</span><span class="m">110</span>, <span class="m">19</span><span class="o">]</span>, <span class="o">[</span>...
<span class="m">4</span>        Chol  <span class="o">[[</span><span class="m">197</span>, <span class="m">6</span><span class="o">]</span>, <span class="o">[</span><span class="m">234</span>, <span class="m">6</span><span class="o">]</span>, <span class="o">[</span><span class="m">204</span>, <span class="m">6</span><span class="o">]</span>, <span class="o">[</span><span class="m">254</span>, <span class="m">5</span><span class="o">]</span>, <span class="o">[</span><span class="m">212</span>,...
<span class="m">5</span>         Fbs                                <span class="o">[[</span><span class="m">0</span>, <span class="m">258</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>, <span class="m">45</span><span class="o">]]</span>
<span class="m">6</span>     RestECG                       <span class="o">[[</span><span class="m">0</span>, <span class="m">151</span><span class="o">]</span>, <span class="o">[</span><span class="m">2</span>, <span class="m">148</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>, <span class="m">4</span><span class="o">]]</span>
<span class="m">7</span>       MaxHR  <span class="o">[[</span><span class="m">162</span>, <span class="m">11</span><span class="o">]</span>, <span class="o">[</span><span class="m">163</span>, <span class="m">9</span><span class="o">]</span>, <span class="o">[</span><span class="m">160</span>, <span class="m">9</span><span class="o">]</span>, <span class="o">[</span><span class="m">152</span>, <span class="m">8</span><span class="o">]</span>, <span class="o">[</span><span class="m">132</span>...
<span class="m">8</span>       ExAng                                <span class="o">[[</span><span class="m">0</span>, <span class="m">204</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>, <span class="m">99</span><span class="o">]]</span>
<span class="m">9</span>     Oldpeak  <span class="o">[[</span><span class="m">0</span>.0, <span class="m">99</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>.2, <span class="m">17</span><span class="o">]</span>, <span class="o">[</span><span class="m">0</span>.6, <span class="m">14</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>.0, <span class="m">14</span><span class="o">]</span>, <span class="o">[</span>...
<span class="m">10</span>      Slope                      <span class="o">[[</span><span class="m">1</span>, <span class="m">142</span><span class="o">]</span>, <span class="o">[</span><span class="m">2</span>, <span class="m">140</span><span class="o">]</span>, <span class="o">[</span><span class="m">3</span>, <span class="m">21</span><span class="o">]]</span>
<span class="m">11</span>         Ca     <span class="o">[[</span><span class="m">0</span>, <span class="m">176</span><span class="o">]</span>, <span class="o">[</span><span class="m">1</span>, <span class="m">65</span><span class="o">]</span>, <span class="o">[</span><span class="m">2</span>, <span class="m">38</span><span class="o">]</span>, <span class="o">[</span><span class="m">3</span>, <span class="m">20</span><span class="o">]</span>, <span class="o">[</span>NA, <span class="m">4</span><span class="o">]]</span>
<span class="m">12</span>       Thal  <span class="o">[[</span>normal, <span class="m">166</span><span class="o">]</span>, <span class="o">[</span>reversable, <span class="m">117</span><span class="o">]</span>, <span class="o">[</span>fixed, <span class="m">18</span><span class="o">]</span>...
<span class="m">13</span>        AHD                            <span class="o">[[</span>No, <span class="m">164</span><span class="o">]</span>, <span class="o">[</span>Yes, <span class="m">139</span><span class="o">]]</span>
<span class="o">================================================================</span>
The Bar plot Bar_plots.pdf was located at:
/home/feng/Dropbox/MyTutorial/PySparkAudit/test/Audited

Process finished with <span class="nb">exit</span> code <span class="m">0</span>
</pre></div>
</div>
<p>and</p>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/bars.png" src="_images/bars.png" />
</div>
</div></blockquote>
</div>
<div class="section" id="auditing-in-one-function">
<h2>4.2. Auditing in one function<a class="headerlink" href="#auditing-in-one-function" title="Permalink to this headline">¶</a></h2>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark regression example&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.some.config.option&quot;</span><span class="p">,</span> <span class="s2">&quot;some-value&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>


<span class="c1"># from PySparkAudit import dtypes_class, hist_plot, bar_plot, freq_items,feature_len</span>
<span class="c1"># from PySparkAudit import dataset_summary, rates, trend_plot</span>

<span class="c1"># path = &#39;/home/feng/Desktop&#39;</span>

<span class="c1"># import PySpark Audit function</span>
<span class="kn">from</span> <span class="nn">PySparkAudit</span> <span class="kn">import</span> <span class="n">auditing</span>

<span class="c1"># load dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;Heart.csv&#39;</span><span class="p">,</span>
                      <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># auditing in one function </span>
<span class="k">print</span><span class="p">(</span><span class="n">auditing</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>Result:</p>
<div class="section" id="print-in-bash">
<h3>4.2.1. print in bash<a class="headerlink" href="#print-in-bash" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">================================================================</span>
The audited results summary audited_results.xlsx was located at:
/home/feng/Dropbox/MyTutorial/PySparkAudit/test/Audited
<span class="o">================================================================</span>
The correlation matrix plot Corr.png was located at:
/home/feng/Dropbox/MyTutorial/PySparkAudit/test/Audited
<span class="o">================================================================</span>
The Histograms plot Histograms.pdf was located at:
/home/feng/Dropbox/MyTutorial/PySparkAudit/test/Audited
Histograms plots are <span class="k">done</span>!
<span class="o">================================================================</span>
The Bar plot Bar_plots.pdf was located at:
/home/feng/Dropbox/MyTutorial/PySparkAudit/test/Audited
Caution: no date features in the dataset!!!
Generate all audited results <span class="nv">took</span> <span class="o">=</span> <span class="m">29</span>.093122243881226 <span class="nv">s</span>
<span class="o">================================================================</span>
The auditing processes are DONE!!!
<span class="o">(</span>   feature  dtypes  row_count    ...     rate_neg  rate_zero  rate_pos
<span class="m">0</span>      Age     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.000000  <span class="m">1</span>.000000
<span class="m">1</span>      Sex     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.320132  <span class="m">0</span>.679868
<span class="m">2</span>   RestBP     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.000000  <span class="m">1</span>.000000
<span class="m">3</span>     Chol     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.000000  <span class="m">1</span>.000000
<span class="m">4</span>      Fbs     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.851485  <span class="m">0</span>.148515
<span class="m">5</span>  RestECG     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.498350  <span class="m">0</span>.501650
<span class="m">6</span>    MaxHR     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.000000  <span class="m">1</span>.000000
<span class="m">7</span>    ExAng     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.673267  <span class="m">0</span>.326733
<span class="m">8</span>  Oldpeak  double        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.326733  <span class="m">0</span>.673267
<span class="m">9</span>    Slope     int        <span class="m">303</span>    ...          <span class="m">0</span>.0   <span class="m">0</span>.000000  <span class="m">1</span>.000000

<span class="o">[</span><span class="m">10</span> rows x <span class="m">22</span> columns<span class="o">]</span>,      feature  dtypes     ...      rate_null  rate_empty
<span class="m">0</span>  ChestPain  string     ...            <span class="m">0</span>.0         <span class="m">0</span>.0
<span class="m">1</span>         Ca  string     ...            <span class="m">0</span>.0         <span class="m">0</span>.0
<span class="m">2</span>       Thal  string     ...            <span class="m">0</span>.0         <span class="m">0</span>.0
<span class="m">3</span>        AHD  string     ...            <span class="m">0</span>.0         <span class="m">0</span>.0

<span class="o">[</span><span class="m">4</span> rows x <span class="m">12</span> columns<span class="o">]</span>,               Age       Sex    RestBP    ...        ExAng   Oldpeak     Slope
Age      <span class="m">1</span>.000000 -0.097542  <span class="m">0</span>.284946    ...     <span class="m">0</span>.091661  <span class="m">0</span>.203805  <span class="m">0</span>.161770
Sex     -0.097542  <span class="m">1</span>.000000 -0.064456    ...     <span class="m">0</span>.146201  <span class="m">0</span>.102173  <span class="m">0</span>.037533
RestBP   <span class="m">0</span>.284946 -0.064456  <span class="m">1</span>.000000    ...     <span class="m">0</span>.064762  <span class="m">0</span>.189171  <span class="m">0</span>.117382
Chol     <span class="m">0</span>.208950 -0.199915  <span class="m">0</span>.130120    ...     <span class="m">0</span>.061310  <span class="m">0</span>.046564 -0.004062
Fbs      <span class="m">0</span>.118530  <span class="m">0</span>.047862  <span class="m">0</span>.175340    ...     <span class="m">0</span>.025665  <span class="m">0</span>.005747  <span class="m">0</span>.059894
RestECG  <span class="m">0</span>.148868  <span class="m">0</span>.021647  <span class="m">0</span>.146560    ...     <span class="m">0</span>.084867  <span class="m">0</span>.114133  <span class="m">0</span>.133946
MaxHR   -0.393806 -0.048663 -0.045351    ...    -0.378103 -0.343085 -0.385601
ExAng    <span class="m">0</span>.091661  <span class="m">0</span>.146201  <span class="m">0</span>.064762    ...     <span class="m">1</span>.000000  <span class="m">0</span>.288223  <span class="m">0</span>.257748
Oldpeak  <span class="m">0</span>.203805  <span class="m">0</span>.102173  <span class="m">0</span>.189171    ...     <span class="m">0</span>.288223  <span class="m">1</span>.000000  <span class="m">0</span>.577537
Slope    <span class="m">0</span>.161770  <span class="m">0</span>.037533  <span class="m">0</span>.117382    ...     <span class="m">0</span>.257748  <span class="m">0</span>.577537  <span class="m">1</span>.000000

<span class="o">[</span><span class="m">10</span> rows x <span class="m">10</span> columns<span class="o">])</span>

Process finished with <span class="nb">exit</span> code <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="section" id="audited-results-folder">
<h3>4.2.2. Audited results folder<a class="headerlink" href="#audited-results-folder" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/t_folder.png" src="_images/t_folder.png" />
</div>
</div></blockquote>
<p>The files in <code class="docutils literal notranslate"><span class="pre">00-audited_results.xlsx</span></code>:</p>
<ol class="arabic simple">
<li>Dataset_summary</li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/t_excel1.png" src="_images/t_excel1.png" />
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Numeric_summary</li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/t_excel2.png" src="_images/t_excel2.png" />
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>Category_summary</li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/t_excel3.png" src="_images/t_excel3.png" />
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Correlation_matrix</li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/t_excel4.png" src="_images/t_excel4.png" />
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Histograms in <code class="docutils literal notranslate"><span class="pre">Histograms.pdf</span></code></li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/hists.png" src="_images/hists.png" />
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Barplots in <code class="docutils literal notranslate"><span class="pre">Bar_plots.pdf</span></code></li>
</ol>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/bars.png" src="_images/bars.png" />
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="auditing-on-big-dataset">
<h2>4.3. Auditing on Big Dataset<a class="headerlink" href="#auditing-on-big-dataset" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will demonstrate the auditing performance and audited results on the big data set.
The data set is <code class="docutils literal notranslate"><span class="pre">Spanish</span> <span class="pre">High</span> <span class="pre">Speed</span> <span class="pre">Rail</span> <span class="pre">tickets</span> <span class="pre">pricing</span></code>.  It is available at :
<a class="reference external" href="https://www.kaggle.com/thegurus/spanish-high-speed-rail-system-ticket-pricing">https://www.kaggle.com/thegurus/spanish-high-speed-rail-system-ticket-pricing</a>. This data set has 2579771
samples and 10 features.</p>
<p>From the following CPU time, you will see most
of the time was spent on plotting the histograms. If your time and memory are limited, we will suggest
you to use <code class="docutils literal notranslate"><span class="pre">sample_size</span></code> to generate the subset of the the dataset to plot histograms.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark regression example&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.some.config.option&quot;</span><span class="p">,</span> <span class="s2">&quot;some-value&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>


<span class="c1"># from PySparkAudit import dtypes_class, hist_plot, bar_plot, freq_items,feature_len</span>
<span class="c1"># from PySparkAudit import dataset_summary, rates, trend_plot</span>

<span class="c1"># Audited results output path</span>
<span class="n">out_path</span> <span class="o">=</span> <span class="s1">&#39;/home/feng/Desktop&#39;</span>

<span class="c1"># import PySpark Audit function</span>
<span class="kn">from</span> <span class="nn">PySparkAudit</span> <span class="kn">import</span> <span class="n">auditing</span>

<span class="c1"># load dataset</span>
<span class="c1"># Spanish High Speed Rail tickets pricing - Renfe (~2.58M)</span>
<span class="c1"># https://www.kaggle.com/thegurus/spanish-high-speed-rail-system-ticket-pricing</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/home/feng/Downloads/renfe.csv&#39;</span><span class="p">,</span>
                      <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># auditing in one function</span>
<span class="n">auditing</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">out_path</span><span class="p">,</span> <span class="n">tracking</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Result:</p>
<div class="section" id="id1">
<h3>4.3.1. print in bash<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">================================================================</span>
The audited results summary audited_results.xlsx was located at:
/home/feng/Desktop/Audited
Generate data <span class="nb">set</span> summary <span class="nv">took</span> <span class="o">=</span> <span class="m">60</span>.535009145736694 <span class="nv">s</span>
<span class="o">================================================================</span>
Collecting data types.... Please be patient!
Generate counts <span class="nv">took</span> <span class="o">=</span> <span class="m">0</span>.0016515254974365234 <span class="nv">s</span>
<span class="o">================================================================</span>
Collecting features<span class="s1">&#39; counts.... Please be patient!</span>
<span class="s1">Generate counts took = 6.502962350845337 s</span>
<span class="s1">================================================================</span>
<span class="s1">Collecting data frame description.... Please be patient!</span>
<span class="s1">Generate data frame description took = 1.5562639236450195 s</span>
<span class="s1">================================================================</span>
<span class="s1">Calculating percentiles.... Please be patient!</span>
<span class="s1">Generate percentiles took = 19.76785445213318 s</span>
<span class="s1">================================================================</span>
<span class="s1">Calculating features&#39;</span> length.... Please be patient!
Generate features<span class="s1">&#39; length took = 4.953453540802002 s</span>
<span class="s1">================================================================</span>
<span class="s1">Calculating top 5 frequent items.... Please be patient!</span>
<span class="s1">Generate rates took: 4.761325359344482 s</span>
<span class="s1">================================================================</span>
<span class="s1">Calculating rates.... Please be patient!</span>
<span class="s1">Generate rates took: 17.201056718826294 s</span>
<span class="s1">Auditing numerical data took = 54.77840781211853 s</span>
<span class="s1">================================================================</span>
<span class="s1">Collecting data types.... Please be patient!</span>
<span class="s1">Generate counts took = 0.001623392105102539 s</span>
<span class="s1">================================================================</span>
<span class="s1">Collecting features&#39;</span> counts.... Please be patient!
Generate counts <span class="nv">took</span> <span class="o">=</span> <span class="m">12</span>.59226107597351 <span class="nv">s</span>
<span class="o">================================================================</span>
Calculating features<span class="s1">&#39; length.... Please be patient!</span>
<span class="s1">Generate features&#39;</span> length <span class="nv">took</span> <span class="o">=</span> <span class="m">5</span>.332952976226807 <span class="nv">s</span>
<span class="o">================================================================</span>
Calculating top <span class="m">5</span> frequent items.... Please be patient!
Generate rates took: <span class="m">6</span>.832213878631592 <span class="nv">s</span>
<span class="o">================================================================</span>
Calculating rates.... Please be patient!
Generate rates took: <span class="m">23</span>.704302072525024 s
Auditing categorical data <span class="nv">took</span> <span class="o">=</span> <span class="m">48</span>.484763622283936 <span class="nv">s</span>
<span class="o">================================================================</span>
The correlation matrix plot Corr.png was located at:
/home/feng/Desktop/Audited
Calculating correlation matrix... Please be patient!
Generate correlation matrix <span class="nv">took</span> <span class="o">=</span> <span class="m">19</span>.61273431777954 <span class="nv">s</span>
<span class="o">================================================================</span>
The Histograms plots *.png were located at:
/home/feng/Desktop/Audited/02-hist
Plotting histograms of _c0.... Please be patient!
Plotting histograms of price.... Please be patient!
Histograms plots are DONE!!!
Generate histograms plots <span class="nv">took</span> <span class="o">=</span> <span class="m">160</span>.3421311378479 <span class="nv">s</span>
<span class="o">================================================================</span>
The Bar plot Bar_plots.pdf was located at:
/home/feng/Desktop/Audited
Plotting barplot of origin.... Please be patient!
Plotting barplot of destination.... Please be patient!
Plotting barplot of train_type.... Please be patient!
Plotting barplot of train_class.... Please be patient!
Plotting barplot of fare.... Please be patient!
Plotting barplot of insert_date.... Please be patient!
Plotting barplot of start_date.... Please be patient!
Plotting barplot of end_date.... Please be patient!
Bar plots are DONE!!!
Generate bar plots <span class="nv">took</span> <span class="o">=</span> <span class="m">24</span>.17994236946106 <span class="nv">s</span>
<span class="o">================================================================</span>
The Trend plot Trend_plots.pdf was located at:
/home/feng/Desktop/Audited
Plotting trend plot of _c0.... Please be patient!
Plotting trend plot of price.... Please be patient!
Trend plots are DONE!!!
Generate trend plots <span class="nv">took</span> <span class="o">=</span> <span class="m">11</span>.697550296783447 s
Generate all the figures <span class="nv">took</span> <span class="o">=</span> <span class="m">196</span>.25823402404785 s
Generate all audited results <span class="nv">took</span> <span class="o">=</span> <span class="m">379</span>.73954820632935 <span class="nv">s</span>
<span class="o">================================================================</span>
The auditing processes are DONE!!!
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>4.3.2. Audited results folder<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="figure align-center">
<img alt="_images/demo3_folder.png" src="_images/demo3_folder.png" />
</div>
</div></blockquote>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>       .,,.
     ,<span class="p">;;</span>*<span class="p">;;;;</span>,
    .-<span class="s1">&#39;``;-&#39;</span><span class="o">)</span><span class="p">;;</span>.
   /<span class="s1">&#39;  .-.  /*;;</span>
<span class="s1"> .&#39;</span>    <span class="se">\d</span>    <span class="se">\;</span><span class="p">;</span>               .<span class="p">;;;</span>,
/ o      <span class="sb">`</span>    <span class="se">\;</span>    ,__.     ,<span class="p">;</span>*<span class="p">;;;</span>*<span class="p">;</span>,
<span class="se">\_</span>_, _.__,<span class="s1">&#39;   \_.-&#39;</span><span class="o">)</span> __<span class="o">)</span>--.<span class="p">;;;;;</span>*<span class="p">;;;;</span>,
 <span class="sb">`</span><span class="s2">&quot;&quot;</span><span class="sb">`</span><span class="p">;;;</span><span class="se">\ </span>      /-<span class="s1">&#39;)_) __)  `\&#39;</span> <span class="s1">&#39;;;;;;;</span>
<span class="s1">    ;*;;;        -&#39;</span><span class="o">)</span> <span class="sb">`</span><span class="o">)</span>_<span class="o">)</span>  <span class="p">|</span><span class="se">\ </span><span class="p">|</span>  <span class="p">;;;;</span>*<span class="p">;</span>
    <span class="p">;;;;|</span>        <span class="sb">`</span>---<span class="sb">`</span>    O <span class="p">|</span> <span class="p">|</span> <span class="p">;;</span>*<span class="p">;;;</span>
    *<span class="p">;</span>*<span class="p">;</span><span class="se">\|</span>                 O  / <span class="p">;;;;;</span>*
   <span class="p">;;;;;</span>/<span class="p">|</span>    .-------<span class="se">\ </span>     / <span class="p">;</span>*<span class="p">;;;;;</span>
  <span class="p">;;;</span>*<span class="p">;</span>/ <span class="se">\ </span>   <span class="p">|</span>        <span class="s1">&#39;.   (`. ;;;*;;;</span>
<span class="s1">  ;;;;;&#39;</span>. <span class="p">;</span>   <span class="p">|</span>          <span class="o">)</span>   <span class="se">\ </span><span class="p">|</span> <span class="p">;;;;;;</span>
  ,<span class="p">;</span>*<span class="p">;;;;</span><span class="se">\/</span>   <span class="p">|</span>.        /   /<span class="sb">`</span> <span class="p">|</span> <span class="s1">&#39;;;;*;</span>
<span class="s1">   ;;;;;;/    |/       /   /__/   &#39;</span><span class="p">;;;</span>
   <span class="s1">&#39;*wf*/     |       /    |      ;*;</span>
<span class="s1">        `&quot;&quot;&quot;&quot;`        `&quot;&quot;&quot;&quot;`     ;&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="5. Main Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basics.html" class="btn btn-neutral float-left" title="3. PySpark Data Audit Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Wenqiang Feng and Yiming Xu
      <span class="lastupdated">
        Last updated on Jul 02, 2019.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>